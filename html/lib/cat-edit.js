/* ---------------------------------------------------------------------------- *\
 *  Film Aficionado is public domain software. Promotional material images,
 *  if present, are copyrighted by the respective copyright owners and should
 *  only be used under the provisions dictated by those copyright holders.
 *  There are no warranties expressed on implied.
\* ---------------------------------------------------------------------------- */
var Context={_isFireFox:navigator.userAgent.match(/gecko/i),_menuHandle:null,setup:function(){if(Filmaf.onPopup)Context._menuHandle=DynarchMenu.setup('context-menu',{context:true,lazy:true,onPopup:Filmaf.onPopup,ctxbutton:1});else Context._menuHandle=DynarchMenu.setup('context-menu',{context:true,lazy:true,ctxbutton:1});},attach:function(click,edit,s_menu,n_calendar_id){var e=$s(click),f=$s(edit);if(Context._menuHandle&&s_menu&&(e||f)){if(s_menu=='calendar'){if(f)f.onclick=Search.calendars[n_calendar_id];if(e)e.onclick=Search.calendars[n_calendar_id];}else{if(f)f.onclick=f.onkeydown=Context._pressButton;if(e)DynarchMenu.setupContext(e,Context._menuHandle.items[s_menu]);}}},_pressButton:function(ev){ev||(ev=window.event);if(ev.keyCode!=9){var e=ev.currentTarget||ev.srcElement;if(e&&e.tagName=='INPUT')e.setAttribute('autocomplete','off');if(e&&e.id&&(e=$('h'+e.id.substr(1))))e.onclick(ev);else alert('Please use the [...] button next to this field to select an option.');}},getPopupPos:function(e,dx,dy){var r=DynarchMenu.getWinSize(),xi=DynarchMenu.psLeft(),yi=DynarchMenu.psTop(),xf=xi+r.x,yf=yi+r.y;r=Context.getPos(e);var xe=r.x,ye=r.y,zh=e.getAttribute('zoom_hoz'),dn=e.getAttribute('zoom_ver')=='down',lf=zh=='left',lo=zh=='leftoffset';r.beg_y=yi;r.end_y=yf;r.bot_y=0;r.x=lf?xe-dx:xe+(lo?0:e.offsetWidth);r.y=ye-1;r.y+=dn?e.offsetHeight:e.offsetHeight*85/100;if(!lf&&r.x+dx>xf)r.x=lo?r.x=xf-dx-1:r.x-e.offsetWidth-dx;if(r.x<xi)r.x=xi;if(r.y+dy>yf){r.bot_y=r.y-(dn?e.offsetHeight:e.offsetHeight*70/100);r.y=r.bot_y-dy;r.bot_y=r.end_y-r.bot_y;}if(r.y<yi)r.y=yi;r.x=Math.floor(r.x);r.y=Math.floor(r.y);return r;},getPos:function(e){var r={x:0,y:0},op,pn;if(e){r.x=e.offsetLeft;r.y=e.offsetTop;op=e.offsetParent;pn=e.parentNode;while(op){r.x+=op.offsetLeft;r.y+=op.offsetTop;if(op!=document.body&&op!=document.documentElement){r.x-=op.scrollLeft;r.y-=op.scrollTop;}if(Context._isFireFox){while(pn&&op!=pn){r.x-=pn.scrollLeft;r.y-=pn.scrollTop;pn=pn.parentNode;}}pn=op.parentNode;op=op.offsetParent;}}return r;},close:function(){if(window.top&&window.top.DynarchMenu)window.top.DynarchMenu._closeOtherMenus(null);}};var Cookie={get:function(n){var c=('; '+document.cookie).replace(/;\s*([A-Za-z0-9_]+\=)/g,';$1'),i=c.indexOf(';'+n+'=');if(i>=0){i+=n.length+2;n=c.indexOf(';',i);return n>i?c.substr(i,n-i):c.substr(i);}return '';},del:function(n){var c=new Date('January 1, 2001');c='; expires='+c.toGMTString()+'; path=/; domain='+Filmaf.cookieDomain;document.cookie=n+'='+c;},set:function(n,v,d){if(typeof(v)=='string'&&!(v=Str.trim(v).replace(/^,+/,'').replace(/,+$/,''))){Cookie.del(n);return;}if(d)if(d<0)d=0;else{var x=d;d=new Date();d.setDate(d.getDate()+x);}else d=new Date(new Date().setFullYear(new Date().getFullYear()+1));d=(d?'; expires='+d.toGMTString():'')+'; path=/; domain='+Filmaf.cookieDomain;document.cookie=n+'='+v+d;},reset:function(keepers){var z=document.cookie.split(';'),i,s,n;keepers='-,'+keepers.toLowerCase()+',';for(i=0;i<z.length;i++){s=Str.trim(z[i]);n=s.indexOf('=');if(n>=0){s=s.substr(0,n);if(keepers.indexOf(','+s.toLowerCase()+',')<0)Cookie.del(s);}}},amend:function(n,k,v){var c=Cookie.get(n).split('*'),s='',b=0,m,i;if(typeof(v)=='string'){if(v.indexOf('*')>0){v=v.replace(/\*/g,'');alert("Illegal character '*' removed from ammended cookie value");}if(v.indexOf('*')>0||v.indexOf('_')>0){k=k.replace(/\*/g,'').replace(/_/g,'');alert("Illegal characters '*' and/or '_' removed from ammended cookie value");}}for(i=0;i<c.length;i++){m=c[i].split('_',1)[0];if(k==m){if(v!='')s+='*'+k+'_'+v;b=1;}else{if(m!='')s+='*'+c[i];}}if(!b&&v!='')s+='*'+k+'_'+v;if(s=='')Cookie.del(n);else Cookie.set(n,s.slice(1));},extract:function(n,k,def){var c=Cookie.get(n).split('*'),i;for(i=0;i<c.length;i++){if(k==c[i].split('_',1)[0])return c[i].slice(k.length+1);}return typeof(def)=='undefined'?'':def;},extractFromStr:function(c,k,def){var i;c=c.split('*');for(i=0;i<c.length;i++){if(k==c[i].split('_',1)[0])return c[i].slice(k.length+1);}return typeof(def)=='undefined'?'':def;},explode:function(n,ints){var c=Cookie.get(n).split('*'),a=[],i;if(c=='')return '';for(i=0;i<c.length;i++){k=c[i].split('_',1)[0];v=c[i].slice(k.length+1);if(ints)a[i]={key:k,val:v};else a[k]=v;}return a;},explodeStr:function(c,ints){var c=c.split('*'),a=[],i;if(c=='')return '';for(i=0;i<c.length;i++){k=c[i].split('_',1)[0];v=c[i].slice(k.length+1);if(ints)a[i]={key:k,val:v};else a[k]=v;}return a;},clean:function(b_all){var b=confirm(b_all?'This action will log you off FilmAf, delete your shopping\ncart and a few other options. Do you wish to proceed?\n\nOK=Yes - Cancel=No':'This action will delete your shopping cart and\na few other options. Do you wish to proceed?\n\nOK=Yes - Cancel=No');if(b)Cookie.reset(b_all?'orig':'user,parm,orig');return b;}};var Dom={getParentByType:function(e,t){if(!t)return null;t=t.toLowerCase();while(e&&e.tagName&&e.tagName.toLowerCase()!=t)e=e.parentNode;return(e&&e.tagName&&e.tagName.toLowerCase()==t)?e:null;},getChildrenByType:function(e,t){var a=[],i;if(t)t=t.toLowerCase();if(t&&e&&e.firstChild){for(i=e.firstChild;i;i=i.nextSibling){if(i.nodeType!=1)continue;if(!t||t==i.tagName.toLowerCase())a[a.length]=i;}}return a;},getFirstChildByType:function(e,t){if(t)t=t.toLowerCase();if(t&&e&&e.firstChild){for(var i=e.firstChild;i;i=i.nextSibling){if(i.nodeType!=1)continue;if(!t||t==i.tagName.toLowerCase())return i;}}return null;},decodeHtmlForInput:function(s){if(!s)return '';var d=document.createElement('div');d.innerHTML=s.replace(/<br\x20?\/?>/g,'_ed_magick_');s=document.all?d.innerText:d.textContent;return s.replace(/_ed_magick_/g,'\n');},decodeHtmlEntities:function(s){if(!s)return '';var d=document.createElement('div');d.innerHTML=s;return document.all?d.innerText:d.textContent;},stripTags:function(s){return s.replace(/[<].*?[>]/g,'');},flipHidden:function(s){var e=$(s),f=$(s+'_sav');if(e&&f){s=f.innerHTML;f.innerHTML=e.innerHTML;e.innerHTML=s;return s!='';}return false;},getElementWidth:function(e){if(typeof e.clip!='undefined')return e.clip.width;if(e.style.pixelWidth)return e.style.pixelWidth;return e.offsetWidth;},getElementHeight:function(e){if(typeof this.clip!='undefined')return this.clip.height;if(this.style.pixelHeight)return this.style.pixelHeight;return this.offsetHeight;}};function $(e){return document.getElementById(e);};function $s(e){return typeof(e)=='string'?document.getElementById(e):(typeof(e)=='object'?e:null);}var Filmaf={baseDomain:'',cookieDomain:'',userCollection:'',viewCollection:'',presentationMode:'',reqPageSize:50,firstRowNo:1,rowsShown:0,onMenuPopup:null,objId:0,lastMoveFolder:'',hasRelWeek:0,loadMainFloat:0,loadContextMenu:0,loadSearchMenu:0,attachExplains:0,contextStr:'',contextMed:'',contextForm:'',inputLine:0,contextRow:0,updatePriceComp:0,config:function(c){var s={s:''},a=$('s_alert'),e=$('context-menu'),r=$('search');if(!c.baseDomain){alert('Missing baseDomain on Filmaf.config');return;}Filmaf.baseDomain=c.baseDomain;if(c.userCollection)Filmaf.userCollection=c.userCollection=='guest'?'':c.userCollection;if(c.viewCollection)Filmaf.viewCollection=c.viewCollection=='www'?'':c.viewCollection;if(c.presentationMode)Filmaf.presentationMode=c.presentationMode;if(c.reqPageSize)Filmaf.reqPageSize=c.reqPageSize;if(c.firstRowNo)Filmaf.firstRowNo=c.firstRowNo;if(c.rowsShown)Filmaf.rowsShown=c.rowsShown;Filmaf.onPopup=c.onPopup?c.onPopup:null;if(c.objId)Filmaf.objId=c.objId;Filmaf.lastMoveFolder=decodeURIComponent(Cookie.get('move'));if(c.hasRelWeek)Filmaf.hasRelWeek=1;if(c.ulExplain)Filmaf.attachExplains=1;if(c.imgPreLoad)Img.preLoad(c.imgPreLoad);if(r)Search.create(0,0);if(c.optionsTag)DropDown.replaceOptions('sel_folder',c.optionsTag);if($('nav_bop'))Menus.cloneNav();if(c.imgHandlers||c.cartHandlers)Img.attach();if(c.cartHandlers)Price.attach();if(c.cartHandlers)Cart.highlight(false);if(c.preloadImgPop)setTimeout('ImgPop.getImgDiv();',200);if(e){if(c.ulAspect)ulAspect(s);if(c.ulBlog)ulBlog(s);if(c.ulBirth)ulBirth(s);if(c.ulCountry)ulCountry(s);if(c.ulDir)ulDir(s);if(c.ulDvd)ulDvd(s);if(c.ulDvdComments)ulDvdComments(s);if(c.ulDvdMany)ulDvdMany(s);if(c.ulDvdOne)ulDvdOne(s);if(c.ulDvdPic)ulDvdPic(s);if(c.ulDvdTitle)ulDvdTitle(s);if(c.ulExplain)ulExplain(s);if(c.ulFilmRating)ulFilmRating(s);if(c.ulGenre)ulGenre(s);if(c.ulHome)ulHome(s);if(c.ulJump)ulJump(s);if(c.ulLang)ulLang(s);if(c.ulPageSize)ulPageSize(s);if(c.ulPerson)ulPerson(s);if(c.ulPicComments)ulPicComments(s);if(c.ulPicMngt)ulPicMngt(s);if(c.ulPub)ulPub(s);if(c.ulRegion)ulRegion(s);if(r)ulSearch(s);if(c.ulStars)ulStars(s);e.innerHTML=s.s;}if(a)alert(a.innerHTML);if(c.splash)splash_me(1);},_getCookieDomain:function(){var c=document.domain?document.domain.match(/\..*\.com$/)||document.domain.match(/\..*\.net$/)||document.domain.match(/\..*\.mil$/)||document.domain.match(/\..*\.edu$/)||document.domain.match(/\..*\.gov$/):'';return typeof(c)=='object'&&c[0]?c[0]:c;}};Filmaf.cookieDomain=Filmaf._getCookieDomain();var Explain={_asAlert:0,attach:function(){var e=window.self.document.getElementsByTagName('img'),i,x;for(i=e.length;--i>=0;){x=e[i];if(x.id&&x.id.substr(0,3)=='ex_'){Context.attach(x,false,'menu-explain-pop');e.onmouseover=function(ev){Img.mouseOver(ev,this,5);};e.onmouseout=function(){Img.mouseOut(this,5);};}}},show:function(s,b_popup){Explain._asAlert=b_popup?0:1;s=s.replace(/_[0-9]+$/,'').replace(/^ex_/,'');Ajax.asynch('explain','Explain.__paint','?s='+s,0,100);var e=$('explain_div');if(e)e.innerHTML='&nbsp;';},__paint:function(){function parse(s,t){var i,u,v;s=s.split('\t');for(i=0;i<s.length;i+=2){u=s[i+1];v=Dom.decodeHtmlForInput(u);switch(s[i]){case 'keyword':t.keyword=u;break;case 'width':t.width=Dec.parse(u);break;case 'explain':t.explain=u;break;}}return typeof(t.explain)=='string';};if(Ajax.ready()){var a=Ajax.getLines(),b={},e,s,w;if(a.length>=3&&parse(a[2],b)){if(b.explain=='Not found')s='Need to write "Explain" for '+b.keyword+'.';else s=b.explain;}else{s='"Explain" is experiencing problems.\nPlease try again soon or report the issue at http://dvdaf.net.\n\nSorry for the inconvenience.';}if(!Explain._asAlert&&(e=$('explain_div'))){e.innerHTML="<div>"+s+"<div style='margin:4px 0 4px 0;text-align:right'><input type='button' value='close' onclick='Context.close()'></div></div>";}else{alert(s);}}},nav:function(s){Explain.show(s,true);}};var Menus={setup:function(){if($('main-menu'))DynarchMenu.setup('main-menu',{lazy:true,electric:1000,tooltips:true,scrolling:true});if($('context-menu'))Context.setup();if($('search'))Search.setup(1);if(Filmaf.attachExplains)Explain.attach();},cloneNav:function(){var e,f;if((e=$('nav_top'))&&(f=$('nav_bop'))){f.innerHTML=e.innerHTML.replace(/<td width=.8%.><select.*\/select><\/td>/i,'').replace(/sz_page_0/,'sz_page_1').replace(/ex_www_titles_disks_0/,'ex_www_titles_disks_1').replace(/ex_www_dvd_cart_0/,'ex_www_dvd_cart_1').replace(/cart_count_0/,'cart_count_1').replace(/dp_jump_0/,'dp_jump_1');}}};var Win={openPop:function(b_refresh,s_target,s_url,n_width,n_height,b_reduced,b_scroll){s_url=s_url.replace(/\&amp;/g,'&');b_scroll=b_scroll?'1':'0';if(b_refresh){var t=new Date();s_url=s_url+(s_url.indexOf('?')<0?'?':'&')+'refresh='+t.getTime();}var o_wnd=window.open(s_url,s_target,(b_reduced?'resizable=1,menubar=0,toolbar=0,location=0,directories=0,scrollbars='+b_scroll+',status=0,titlebar=0'+(n_width>0&&n_height>0?',width='+n_width+'px,height='+n_height+'px':''):''));if(o_wnd)o_wnd.focus();return false;},openStd:function(s_url,w){s_url=s_url.replace(/\&amp;/g,'&');if(typeof(w)=='object')if(!w||w.closed)w=window.open(s_url);else w.location=s_url;else w=window.open(s_url,w);if(w)w.focus();return true;},openDyn:function(s_target,s_title,n_width,n_height,b_reduced,s_inc,s_onload,b_scroll){b_scroll=b_scroll?'1':'0';var o_wnd=window.open('',s_target,(b_reduced?'resizable=0,menubar=0,toolbar=0,location=0,directories=0,scrollbars='+b_scroll+',status=0,titlebar=0'+(n_width>0&&n_height>0?',width='+n_width+'px,height='+n_height+'px':''):''));if(o_wnd){o_wnd.document.writeln("<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'DTD/xhtml1-transitional.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>\n<head>\n<title>"+s_title+"</title>\n<meta http-equiv='Content-type' content='text/html; charset=UTF-8' />\n"+s_inc+"</head>\n<body onload='"+(s_onload?s_onload+';':'')+"self.focus()'>");}return o_wnd;},endDyn:function(o_wnd){if(o_wnd){o_wnd.document.writeln("</body>\n</html>");o_wnd.document.close();}},showPic:function(s_pic){Win.openPop(false,'large_pic',Filmaf.baseDomain+'/utils/lp.html?pic='+s_pic,354,468,1,0);},reauth:function(s_redirect){if(!s_redirect)s_redirect='/utils/close.html%3Fmsg%3D1';Win.openPop(0,'_blank','/utils/login.html?redirect='+s_redirect,680,520,1,0);},findFrame:function(s_id){var i;for(i=0;i<parent.frames.length;i++){var elid;try{elid=parent.frames[i].frameElement.id}catch(e){elid='verbotten';}if(elid==s_id)return parent.frames[i].document;}return 0;}};function ulExplain(s){s.s+="<li id='menu-explain-pop' class='context-class-a-explain'><ul id='explain_pop'><li><div style='margin:4px 0 4px 0;width:300px'><form id='mform_explain' name='mform_explain' onsubmit='return false' action=''><div id='explain_div' style='margin:4px 0 4px 0'><div><div style='margin:4px 0 4px 0;text-align:right'><input type='button' value='close' onclick='Context.close()'></div></div></div></form></div></li></ul></li>";};var Tab={_length:[],_options:[],_wholepage:false,targetDiv:'',setup:function(tab_id,options){var el=$(tab_id);if(!el){alert('Could not find a tab control by the name "'+tab_id+'".');return;}var a=Dom.getChildrenByType(el,'ul');a=Dom.getChildrenByType(a.length>0?a[0]:el,'li');if(!(a.length>0)){alert('No tab definitions found for "'+tab_id+'".');return;}var k=Tab._length.length;Tab._length[k]=a.length;Tab._options[k]={};Tab._wholepage=(options&&typeof(options['wholepage'])!='undefined')?options['wholepage']=='1':false;Tab.getCmdOptions(Tab._options[k],options,'loadtab',0,0,a.length-1);Tab.getCmdOptions(Tab._options[k],options,'width');Tab.getCmdOptions(Tab._options[k],options,'background');Tab.getCmdOptions(Tab._options[k],options,'padding','8px');Tab.getCmdOptions(Tab._options[k],options,'populate',true);var op=Tab._options[k];var s="<table cellpadding='0' style='position:relative;"+(op.width?" width:"+op.width+";":'')+(op.background?" background:"+op.background+";":'')+(op.padding?" padding:"+op.padding+";":'')+"'><tr><td><table cellpadding='0' width='100%'><tr><td><table cellpadding='0'><tr style='position:relative;z-index:2'><tr>";var href=[];var hdiv=[];for(var i=0;i<a.length;i++){var b=Dom.getChildrenByType(a[i],'a');var label,dx;if(b.length>0){label=b[0].innerHTML;dx=b[0].offsetWidth+20+'px';href[i]=b[0].href;}else{b=Dom.getChildrenByType(a[i],'div');if(b.length>0){hdiv[i]=b[0].innerHTML;a[i].removeChild(a[i].lastChild);}label=a[i].innerHTML;a[i].innerHTML='<span>'+label+'</span>';b=Dom.getChildrenByType(a[i],'span');dx=b.length>0?b[0].offsetWidth+20+'px':'10em';}s+="<td><div class='tab-00' onmouseover='Tab.set("+k+","+i+",1,false);' onmouseout='Tab.set("+k+","+i+",0,false);' onclick='Tab.set("+k+","+i+",2,true);'><div class='tab-01'><div class='tab-10'><div class='tab-11'><div class='tab-xx'><div id='tab"+k+"_"+i+"' unselectable='on' style='width: "+dx+";padding:5px 0 4px 0'>"+label+"</div></div></div></div></div></div></td>";}s+="</tr></table></td></tr><tr><td><table cellpadding='0' width='100%'><tr style='position:relative;z-index:0'><tr><td><div class='cab-t'><div class='cab-b'><div class='cab-r'><div class='cab-l' id='tab"+k+"_div' >&nbsp;</div></div></div></div></td></tr></table></td></tr></table></td></tr></table>";el.innerHTML=s;for(var i=0;i<a.length;i++){el=$('tab'+k+'_'+i);if(el){if(href[i])el['tab_href']=href[i];if(hdiv[i])el['tab_hdiv']=hdiv[i];}}Tab.set(k,op.loadtab,2,op.populate);},set:function(n_tab,n_id,n_state,b_populate){var el=$('tab'+n_tab+'_'+n_id);var ch=n_state==2?'s':(n_state==1?'h':'t');var ol;if(!el)return;if(n_state==2){el['tab_selected']=1;for(var i=0;i<Tab._length[n_tab];i++){if(i==n_id)continue;ol=$('tab'+n_tab+'_'+i);if(ol&&ol.tab_selected==1){ol.tab_selected=0;Tab.set(n_tab,i,0,false);}}Tab.targetDiv='tab'+n_tab+'_div';if(b_populate){ol=$(Tab.targetDiv);if(ol){if(el.tab_hdiv){ol.innerHTML=el.tab_hdiv;}else{var href=el.tab_href?el.tab_href.replace(/%22/g,'"'):'about:blank';if(href.substr(0,11)=='javascript:'){eval(href.substr(11));}else{if(Tab._wholepage){location.href=href;}else{ol.innerHTML="<iframe id='tab"+n_tab+"_frame' scrolling='no' width='99%' frameborder='0' marginwidth='0' src='"+href+"'>Oops, your browser does not support iframes, please follow <a href='"+href+"'>this link</a>.</iframe>";}}}}}}else{if(el['tab_selected']==1)ch='s';}el=el.parentNode;el.className=ch+'ab-xx';el=el.parentNode;el.className=ch+'ab-11';el=el.parentNode;el.className=ch+'ab-10';el=el.parentNode;el.className=ch+'ab-01';el=el.parentNode;el.className=ch+'ab-00';},iframeResize:function(s_id){var el=$(s_id);if(el&&el.contentWindow&&el.contentWindow.document&&el.contentWindow.document.body&&el.contentWindow.document.body.scrollHeight){if(el.scrollHeight<el.contentWindow.document.body.scrollHeight+20)el.style.height=Dec.parse(el.contentWindow.document.body.scrollHeight)+20+'px';}},getCmdOptions:function(a,o,s_item,s_default,n_min,n_max){if(o&&typeof(o[s_item])!='undefined'){a[s_item]=o[s_item];if(n_min&&n_max&&(a[s_item]<n_min||a[s_item]>n_max))a[s_item]=s_default;}else{a[s_item]=s_default;}}};