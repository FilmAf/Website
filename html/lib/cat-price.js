/* ---------------------------------------------------------------------------- *\
 *  Film Aficionado is public domain software. Promotional material images,
 *  if present, are copyrighted by the respective copyright owners and should
 *  only be used under the provisions dictated by those copyright holders.
 *  There are no warranties expressed on implied.
\* ---------------------------------------------------------------------------- */
var Cookie={get:function(n){var c=('; '+document.cookie).replace(/;\s*([A-Za-z0-9_]+\=)/g,';$1'),i=c.indexOf(';'+n+'=');if(i>=0){i+=n.length+2;n=c.indexOf(';',i);return n>i?c.substr(i,n-i):c.substr(i);}return '';},del:function(n){var c=new Date('January 1, 2001');c='; expires='+c.toGMTString()+'; path=/; domain='+Filmaf.cookieDomain;document.cookie=n+'='+c;},set:function(n,v,d){if(typeof(v)=='string'&&!(v=Str.trim(v).replace(/^,+/,'').replace(/,+$/,''))){Cookie.del(n);return;}if(d)if(d<0)d=0;else{var x=d;d=new Date();d.setDate(d.getDate()+x);}else d=new Date(new Date().setFullYear(new Date().getFullYear()+1));d=(d?'; expires='+d.toGMTString():'')+'; path=/; domain='+Filmaf.cookieDomain;document.cookie=n+'='+v+d;},reset:function(keepers){var z=document.cookie.split(';'),i,s,n;keepers='-,'+keepers.toLowerCase()+',';for(i=0;i<z.length;i++){s=Str.trim(z[i]);n=s.indexOf('=');if(n>=0){s=s.substr(0,n);if(keepers.indexOf(','+s.toLowerCase()+',')<0)Cookie.del(s);}}},amend:function(n,k,v){var c=Cookie.get(n).split('*'),s='',b=0,m,i;if(typeof(v)=='string'){if(v.indexOf('*')>0){v=v.replace(/\*/g,'');alert("Illegal character '*' removed from ammended cookie value");}if(v.indexOf('*')>0||v.indexOf('_')>0){k=k.replace(/\*/g,'').replace(/_/g,'');alert("Illegal characters '*' and/or '_' removed from ammended cookie value");}}for(i=0;i<c.length;i++){m=c[i].split('_',1)[0];if(k==m){if(v!='')s+='*'+k+'_'+v;b=1;}else{if(m!='')s+='*'+c[i];}}if(!b&&v!='')s+='*'+k+'_'+v;if(s=='')Cookie.del(n);else Cookie.set(n,s.slice(1));},extract:function(n,k,def){var c=Cookie.get(n).split('*'),i;for(i=0;i<c.length;i++){if(k==c[i].split('_',1)[0])return c[i].slice(k.length+1);}return typeof(def)=='undefined'?'':def;},extractFromStr:function(c,k,def){var i;c=c.split('*');for(i=0;i<c.length;i++){if(k==c[i].split('_',1)[0])return c[i].slice(k.length+1);}return typeof(def)=='undefined'?'':def;},explode:function(n,ints){var c=Cookie.get(n).split('*'),a=[],i;if(c=='')return '';for(i=0;i<c.length;i++){k=c[i].split('_',1)[0];v=c[i].slice(k.length+1);if(ints)a[i]={key:k,val:v};else a[k]=v;}return a;},explodeStr:function(c,ints){var c=c.split('*'),a=[],i;if(c=='')return '';for(i=0;i<c.length;i++){k=c[i].split('_',1)[0];v=c[i].slice(k.length+1);if(ints)a[i]={key:k,val:v};else a[k]=v;}return a;},clean:function(b_all){var b=confirm(b_all?'This action will log you off FilmAf, delete your shopping\ncart and a few other options. Do you wish to proceed?\n\nOK=Yes - Cancel=No':'This action will delete your shopping cart and\na few other options. Do you wish to proceed?\n\nOK=Yes - Cancel=No');if(b)Cookie.reset(b_all?'orig':'user,parm,orig');return b;}};var Dbl={parse:function(s){s=parseFloat(s);return isNaN(s)?0:s;},parseBounded:function(s,min,max,b_allow_empty,b_money){if(typeof(b_money)=='undefined')b_money=false;var re_1,re_2,b_not_num,b_bounds,b_neg=false;s=Str.trim(s);if(s=='')return b_allow_empty?'':false;if(s.substr(0,1)=='-'){b_neg=true;s=s.substr(1);}if(b_money){re_1=/^([0-9]+)[,.]*([0-9]{0,2})$/;re_2=/^[0-9]+[\.]*[0-9]{0,2}%?$/;}else{re_1=/^([0-9]+)[,.]*([0-9]{0,5})$/;re_2=/^[0-9]+[\.]*[0-9]{0,5}%?$/;}s=s.replace(re_1,'$1.$2'). replace(/^([0-9]+)[,.]*$/,'$1');b_not_num=s.match(re_2)==null;b_bounds=b_not_num?false:(max>min?(Dbl.parse(s)>max||Dbl.parse(s)<min):false);if(b_not_num||b_bounds)return false;return b_neg?'-'+s:s;},toStr:function(v,s_on_zero){if(v>-0.005&&v<0.005)return s_on_zero;v+=v>0?0.005:-0.005;v=''+v;var n=v.indexOf('.');if(n>0)return v.substr(0,n)+'.'+(v.substr(n+1)+'00').substr(0,2);return v+'.00';},toUsd:function(v){v=Dbl.toStr(v,'0.00');var m=v.indexOf('-')>=0?1:0,n=v.indexOf('.');if(n-m>3)v=v.substr(0,n-3)+','+v.substr(n-3);return v;},validate:function(s_field,o_changed,e_min,e_max,b_allow_empty,s_name,b_must_change,b_money){if(typeof(b_money)=='undefined')b_money=false;var s,e_new,e_old,b_same;if((e_new=$(s_field))){if(o_changed&&!o_changed.b_undo&&(e_old=$('z_'+s_field.substr(2))))o_changed.b_undo=Str.trim(e_new.value)!=Str.trim(e_old.value);b_same=(e_old=$('o_'+s_field.substr(2)))&&(s=Str.trim(e_new.value))==Str.trim(e_old.value);if(b_same&&!b_must_change)return s;s=Validate.checkEmptiness(e_new,b_allow_empty,s_name);if(s===false)return false;if(!e_old&&s=='')b_same=true;s=Dbl.parseBounded(s,e_min,e_max,b_allow_empty,b_money);if(s===false){Validate.warn(e_new,true,true,s_name+' must be a number between '+e_min+' and '+e_max+' with up to '+(b_money?'two':'five')+' decimal digits.\nYou entered "'+e_new.value+'".',false);return false;}if(o_changed&&!o_changed.b_changed)o_changed.b_changed=!b_same;e_new.value=s;return s;}return '';}};var Dec={parse:function(s){s=parseInt(s,10);return isNaN(s)?0:s;},parseBounded:function(s,min,max,b_allow_empty){s=Str.trim(s);if(s=='')return b_allow_empty?'':false;var b_not_num=s.match(/^[+-]?[0-9]+$/)==null;var b_bounds=b_not_num?false:(max>min?(Dec.parse(s)>max||Dec.parse(s)<min):false);if(b_not_num||b_bounds)return false;return s;},validateN:function(s_field,n_cnt,o_changed,e_min,e_max,b_allow_empty,s_name,b_must_change){var i,b;for(i=0,b=true;b!==false&&i<n_cnt;i++)b=Dec.validate(s_field+i,o_changed,e_min,e_max,i?1:b_allow_empty,i?s_name+(i+1):Str.trim(s_name),i?0:b_must_change);return b!==false;},validate:function(s_field,o_changed,e_min,e_max,b_allow_empty,s_name,b_must_change){var s,e_new,e_old,b_same;if((e_new=$(s_field))){if(o_changed&&!o_changed.b_undo&&(e_old=$('z_'+s_field.substr(2))))o_changed.b_undo=Str.trim(e_new.value)!=Str.trim(e_old.value);b_same=(e_old=$('o_'+s_field.substr(2)))&&(s=Str.trim(e_new.value))==Str.trim(e_old.value);if(((s!=''&&s!='0')||b_allow_empty)&&b_same&&!b_must_change)return s;s=Validate.checkEmptiness(e_new,b_allow_empty,s_name);if(s===false)return false;if(!e_old&&s=='')b_same=true;s=Dec.parseBounded(s,e_min,e_max,b_allow_empty);if(s===false){Validate.warn(e_new,true,true,s_name+' must be an integer'+(e_max>e_min?(' between '+e_min+' and '+e_max):'')+'.\nYou entered "'+e_new.value+'".',false);return false;}if(o_changed&&!o_changed.b_changed)o_changed.b_changed=!b_same;e_new.value=s;return s;}return '';}};var DropDown={_option_syntax:0,getSelIndex:function(e){return(e=$s(e))?e.selectedIndex:-1;},getSelValue:function(e){return(e=$s(e))?e.options[e.selectedIndex].value:'';},selectFromIndex:function(e,i){if((e=$s(e))&&e.options&&i>=0&&i<e.options.length)return e.options[i].selected=true;return false;},selectFromVal:function(e,v){if((e=$s(e))&&e.options&&(v=DropDown.indexFromVal(e,v))>=0)return e.options[v].selected=true;return false;},indexFromVal:function(e,v){if((e=$s(e))&&(e=e.options))for(var i=0;i<e.length;i++)if(e[i].value==v)return i;return-1;},replaceOptions:function(trg,src){function addChildren(t,s){for(s=s.firstChild;s;s=s.nextSibling){switch(s.tagName.toLowerCase()){case 'a':h=s.href.match(/^http\:\/\/([^\/]+)\/([^?&]+)/i);if(h&&h[2]&&h[2]!='trash-can'&&h[1].substr(0,4)!='www.'){DropDown.addOption(t,h[2],h[2]);if(h[2]==Filmaf.lastMoveFolder)t.selectedIndex=n;n++;}break;case 'li':case 'ul':addChildren(t,s);break;}}};var t=$s(trg),s=$s(src),n=0,h;if(t&&s){DropDown.removeOptions(t);addChildren(t,s);}},removeOptions:function(e){e=$s(e);while(e.length>0)e.remove(0);},addOption:function(sel,val,txt){if(sel&&sel.add){var f=document.createElement('option');f.value=val;f.text=txt;if(DropDown._option_syntax==1)sel.add(f,null);else if(DropDown._option_syntax==2)sel.add(f);else try{sel.add(f,null);DropDown._option_syntax=1;}catch(ex){sel.add(f);DropDown._option_syntax=2;}}}};function $(e){return document.getElementById(e);};function $s(e){return typeof(e)=='string'?document.getElementById(e):(typeof(e)=='object'?e:null);}var Filmaf={baseDomain:'',cookieDomain:'',userCollection:'',viewCollection:'',presentationMode:'',reqPageSize:50,firstRowNo:1,rowsShown:0,onMenuPopup:null,objId:0,lastMoveFolder:'',hasRelWeek:0,loadMainFloat:0,loadContextMenu:0,loadSearchMenu:0,attachExplains:0,contextStr:'',contextMed:'',contextForm:'',inputLine:0,contextRow:0,updatePriceComp:0,config:function(c){var s={s:''},a=$('s_alert'),e=$('context-menu'),r=$('search');if(!c.baseDomain){alert('Missing baseDomain on Filmaf.config');return;}Filmaf.baseDomain=c.baseDomain;if(c.userCollection)Filmaf.userCollection=c.userCollection=='guest'?'':c.userCollection;if(c.viewCollection)Filmaf.viewCollection=c.viewCollection=='www'?'':c.viewCollection;if(c.presentationMode)Filmaf.presentationMode=c.presentationMode;if(c.reqPageSize)Filmaf.reqPageSize=c.reqPageSize;if(c.firstRowNo)Filmaf.firstRowNo=c.firstRowNo;if(c.rowsShown)Filmaf.rowsShown=c.rowsShown;Filmaf.onPopup=c.onPopup?c.onPopup:null;if(c.objId)Filmaf.objId=c.objId;Filmaf.lastMoveFolder=decodeURIComponent(Cookie.get('move'));if(c.hasRelWeek)Filmaf.hasRelWeek=1;if(c.ulExplain)Filmaf.attachExplains=1;if(c.imgPreLoad)Img.preLoad(c.imgPreLoad);if(r)Search.create(0,0);if(c.optionsTag)DropDown.replaceOptions('sel_folder',c.optionsTag);if($('nav_bop'))Menus.cloneNav();if(c.imgHandlers||c.cartHandlers)Img.attach();if(c.cartHandlers)Price.attach();if(c.cartHandlers)Cart.highlight(false);if(c.preloadImgPop)setTimeout('ImgPop.getImgDiv();',200);if(e){if(c.ulAspect)ulAspect(s);if(c.ulBlog)ulBlog(s);if(c.ulBirth)ulBirth(s);if(c.ulCountry)ulCountry(s);if(c.ulDir)ulDir(s);if(c.ulDvd)ulDvd(s);if(c.ulDvdComments)ulDvdComments(s);if(c.ulDvdMany)ulDvdMany(s);if(c.ulDvdOne)ulDvdOne(s);if(c.ulDvdPic)ulDvdPic(s);if(c.ulDvdTitle)ulDvdTitle(s);if(c.ulExplain)ulExplain(s);if(c.ulFilmRating)ulFilmRating(s);if(c.ulGenre)ulGenre(s);if(c.ulHome)ulHome(s);if(c.ulJump)ulJump(s);if(c.ulLang)ulLang(s);if(c.ulPageSize)ulPageSize(s);if(c.ulPerson)ulPerson(s);if(c.ulPicComments)ulPicComments(s);if(c.ulPicMngt)ulPicMngt(s);if(c.ulPub)ulPub(s);if(c.ulRegion)ulRegion(s);if(r)ulSearch(s);if(c.ulStars)ulStars(s);e.innerHTML=s.s;}if(a)alert(a.innerHTML);if(c.splash)splash_me(1);},_getCookieDomain:function(){var c=document.domain?document.domain.match(/\..*\.com$/)||document.domain.match(/\..*\.net$/)||document.domain.match(/\..*\.mil$/)||document.domain.match(/\..*\.edu$/)||document.domain.match(/\..*\.gov$/):'';return typeof(c)=='object'&&c[0]?c[0]:c;}};Filmaf.cookieDomain=Filmaf._getCookieDomain();var Str={trim:function(s){return s.replace(/^[\s]+/,''). replace(/[\s]+$/,''). replace(/[\t\r\x20]+/g,' '). replace(/\x20\n/g,'\n').replace(/\n\x20/g,'\n');},trimR:function(s){return s.replace(/[\s]+$/,''). replace(/[\t\r\x20]+/g,' '). replace(/\x20\n/g,'\n').replace(/\n\x20/g,'\n');},trimL:function(s){return s.replace(/^[\s]+/,''). replace(/[\t\r\x20]+/g,' '). replace(/\x20\n/g,'\n').replace(/\n\x20/g,'\n');},firstLine:function(s){var n;s=s.replace(/^[\s]+/,'');if((n=s.indexOf('\n'))>1)s=s.substr(0,n);return s.replace(/[\s]+$/,''). replace(/[\s]+/g,' ');},ucFirst:function(s){return s.substr(0,1).toUpperCase()+s.substr(1);},ucWords:function(s){return(s).replace(/^(.)|\s(.)/g,function($1){return $1.toUpperCase();});},ucTitle:function(s){var x=s.split(' '),t=x.length,i,w;for(i=0,s='';i<t;i++){w=x[i];s+=' '+(i&&',the,a,an,aboard,about,above,across,after,against,along,amid,among,anti,around,as,at,before,behind,below,beneath,beside,besides,between,beyond,but,by,concerning,considering,despite,down,during,except,excepting,excluding,following,for,from,in,inside,into,like,minus,near,of,off,on,onto,opposite,outside,over,past,per,plus,regarding,round,save,since,than,through,to,toward,towards,under,underneath,unlike,until,up,upon,vs,versus,via,with,within,without,and,but,for,nor,or,so,yet,to,'.indexOf(','+w+',')>=0?w:w.substr(0,1).toUpperCase()+w.substr(1));}return s.substr(1);},hasSameVal:function(e,f){if((e=$s(e))&&(f=$s(f))&&Str.trim(e.value)!=Str.trim(f.value)){f.style.color='red';f.style.background='#ffcccc';Validate.warn(e,true,true,'The password and the password confirmation fields do not match.',false);return false;}return true;},validateN:function(s_field,n_cnt,o_changed,n_min_len,n_max_len,b_allow_empty,s_name,b_must_change){var i,b;for(i=0,b=true;b!==false&&i<n_cnt;i++)b=Str.validate(s_field+i,o_changed,n_min_len,n_max_len,i?1:b_allow_empty,i?s_name+(i+1):Str.trim(s_name),i?0:b_must_change);return b!==false;},validate:function(s_field,o_changed,n_min_len,n_max_len,b_allow_empty,s_name,b_must_change){var s,n,e_new,e_old,b_same;if((e_new=$(s_field))){if(o_changed&&!o_changed.b_undo&&(e_old=$('z_'+s_field.substr(2))))o_changed.b_undo=Str.trim(e_new.value)!=Str.trim(e_old.value);b_same=(e_old=$('o_'+s_field.substr(2)))&&(s=Str.trim(e_new.value))==Str.trim(e_old.value);if(b_same&&!b_must_change)return s;s=Validate.checkEmptiness(e_new,b_allow_empty,s_name);if(s===false)return false;if(!e_old&&s=='')b_same=true;n=s.length;if(n_max_len>0&&n>n_max_len){Validate.warn(e_new,true,true,s_name+' must have no more than '+n_max_len+' characters. You entered '+n+'.',false);return false;}if(n_min_len>0&&n<n_min_len){Validate.warn(e_new,true,true,s_name+' must have at least '+n_min_len+' characters. You entered '+n+'.',false);return false;}if(o_changed&&!o_changed.b_changed)o_changed.b_changed=!b_same;e_new.value=s;return s;}return '';}};var Win={openPop:function(b_refresh,s_target,s_url,n_width,n_height,b_reduced,b_scroll){s_url=s_url.replace(/\&amp;/g,'&');b_scroll=b_scroll?'1':'0';if(b_refresh){var t=new Date();s_url=s_url+(s_url.indexOf('?')<0?'?':'&')+'refresh='+t.getTime();}var o_wnd=window.open(s_url,s_target,(b_reduced?'resizable=1,menubar=0,toolbar=0,location=0,directories=0,scrollbars='+b_scroll+',status=0,titlebar=0'+(n_width>0&&n_height>0?',width='+n_width+'px,height='+n_height+'px':''):''));if(o_wnd)o_wnd.focus();return false;},openStd:function(s_url,w){s_url=s_url.replace(/\&amp;/g,'&');if(typeof(w)=='object')if(!w||w.closed)w=window.open(s_url);else w.location=s_url;else w=window.open(s_url,w);if(w)w.focus();return true;},openDyn:function(s_target,s_title,n_width,n_height,b_reduced,s_inc,s_onload,b_scroll){b_scroll=b_scroll?'1':'0';var o_wnd=window.open('',s_target,(b_reduced?'resizable=0,menubar=0,toolbar=0,location=0,directories=0,scrollbars='+b_scroll+',status=0,titlebar=0'+(n_width>0&&n_height>0?',width='+n_width+'px,height='+n_height+'px':''):''));if(o_wnd){o_wnd.document.writeln("<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'DTD/xhtml1-transitional.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>\n<head>\n<title>"+s_title+"</title>\n<meta http-equiv='Content-type' content='text/html; charset=UTF-8' />\n"+s_inc+"</head>\n<body onload='"+(s_onload?s_onload+';':'')+"self.focus()'>");}return o_wnd;},endDyn:function(o_wnd){if(o_wnd){o_wnd.document.writeln("</body>\n</html>");o_wnd.document.close();}},showPic:function(s_pic){Win.openPop(false,'large_pic',Filmaf.baseDomain+'/utils/lp.html?pic='+s_pic,354,468,1,0);},reauth:function(s_redirect){if(!s_redirect)s_redirect='/utils/close.html%3Fmsg%3D1';Win.openPop(0,'_blank','/utils/login.html?redirect='+s_redirect,680,520,1,0);},findFrame:function(s_id){var i;for(i=0;i<parent.frames.length;i++){var elid;try{elid=parent.frames[i].frameElement.id}catch(e){elid='verbotten';}if(elid==s_id)return parent.frames[i].document;}return 0;}};var DvdPrice={_calcMany:1,_totVendors:6,_vendor:[{key:'amz',name:'Amazon',tax:{'KS':5.3,'KY':6,'NYC':8.75,'NY':4,'ND':5,'WA':6.5},ship:function(n,v){return v>=25||!n?0:1.99+n*0.99;}},{key:'buy',name:'Buy.com',tax:{'CA':7.25,'MA':5,'TN':9.25,'NYC':8.75,'NY':4},ship:function(n,v){return v>=25||!n?0:1.45+n*0.45;}},{key:'pla',name:'DVD Planet',tax:{'CA':7.25,'IL':7.75},ship:function(n,v){return v>=35||!n?0:1.50;}},{key:'ddd',name:'Deep Discount',tax:{'IL':7.75},ship:function(n,v){return 0;}},{key:'ovr',name:'Overstock',tax:{'UT':4.65},ship:function(n,v){return n?2.95:0;}},{key:'exp',name:'DVD Empire',tax:{'PA':6},ship:function(n,v){return 0;}}],onPopup:function(el){if(!this.id)return;var i=this.menu.items,z=this;z.filmaf=DvdListMenuPrep.onPopup;z.filmaf(el);switch(this.id){case 'context_dvd':i.cm_dvd_one.display(0);i.cm_dvd_mine.display(0);break;}},_getState:function(){var s=DropDown.getSelValue('sel_state'),e=$('sp_state');if(e)e.innerHTML=s&&s!='0'?s:'none';return s;},calcPricesMany:function(){DvdPrice._calcMany=1;var a_sel_prc=[],a_sel_cnt=[],a_all_prc=[],a_all_cnt=[],a_low_prc=[],a_low_cnt=[],state=DvdPrice._getState(),i,k,e,v;for(i=0;i<DvdPrice._totVendors;i++){a_sel_prc[i]=0;a_sel_cnt[i]=0;a_low_prc[i]=0;a_low_cnt[i]=0;a_all_prc[i]=0;a_all_cnt[i]=0;}for(k=0;k<compare.totRows;k++){for(i=0;i<DvdPrice._totVendors;i++){if((v=Dbl.parse(compare.prices[k][i]))>0){if((e=$('cx_'+k+'_'+i))&&e.checked){a_sel_prc[i]+=v;a_sel_cnt[i]++;}if(compare.lowest[k]==i){a_low_prc[i]+=v;a_low_cnt[i]++;}a_all_prc[i]+=v;a_all_cnt[i]++;}}}var e_sel_prc=0,e_sel_cnt=0,e_low_prc=0,e_low_cnt=0;for(i=0;i<DvdPrice._totVendors;i++){e_sel_prc+=a_sel_prc[i];e_sel_cnt+=a_sel_cnt[i];e_low_prc+=a_low_prc[i];e_low_cnt+=a_low_cnt[i];if((e=$('td_sub'+i)))e.innerHTML="<div>"+Dbl.toStr(a_sel_prc[i],'-')+'<br />('+DvdPrice._strItems(a_sel_cnt[i])+')</div>'+"<div>"+Dbl.toStr(a_all_prc[i],'-')+'<br />('+DvdPrice._strItems(a_all_cnt[i])+')</div>';}if((e=$('td_subsel')))e.innerHTML="<div>"+Dbl.toStr(e_sel_prc,'-')+'<br />('+DvdPrice._strItems(e_sel_cnt)+')</div>';if((e=$('td_sublow')))e.innerHTML=Dbl.toStr(e_low_prc,'-')+'<br />('+DvdPrice._strItems(e_low_cnt)+')';var a_sel_shp=DvdPrice._calcShipping(a_sel_prc,a_sel_cnt),a_low_shp=DvdPrice._calcShipping(a_low_prc,a_low_cnt),a_sel_tax=DvdPrice._calcTaxes(a_sel_prc,state),a_low_tax=DvdPrice._calcTaxes(a_low_prc,state),e_sel_shp=0,e_low_shp=0,e_sel_tax=0,e_low_tax=0;e_sel_prc=0,e_low_prc=0;for(i=0;i<DvdPrice._totVendors;i++){e_sel_shp+=a_sel_shp[i];e_low_shp+=a_low_shp[i];e_sel_tax+=a_sel_tax[i];e_low_tax+=a_low_tax[i];e_sel_prc+=a_sel_prc[i];e_low_prc+=a_low_prc[i];if((e=$('td_shp'+i)))e.innerHTML=Dbl.toStr(a_sel_shp[i],'-');if((e=$('td_tax'+i)))e.innerHTML=Dbl.toStr(a_sel_tax[i],'-');if((e=$('td_tot'+i)))e.innerHTML=Dbl.toStr(a_sel_prc[i]+a_sel_shp[i]+a_sel_tax[i],'-');}if((e=$('td_shpsel')))e.innerHTML="<div>"+Dbl.toStr(e_sel_shp,'-')+'</div>';if((e=$('td_shplow')))e.innerHTML=Dbl.toStr(e_low_shp,'-');if((e=$('td_taxsel')))e.innerHTML="<div>"+Dbl.toStr(e_sel_tax,'-')+'</div>';if((e=$('td_taxlow')))e.innerHTML=Dbl.toStr(e_low_tax,'-');if((e=$('td_totsel')))e.innerHTML="<div>"+Dbl.toStr(e_sel_prc+e_sel_shp+e_sel_tax,'-')+'</div>';if((e=$('td_totlow')))e.innerHTML=Dbl.toStr(e_low_prc+e_low_shp+e_low_tax,'-');},populateVendors:function(){var e,k;for(k=0;k<compare.totRows;k++){if((e=$('td_lo'+k)))e.innerHTML=DvdPrice._vendor[compare.lowest[k]].name;if((e=$('td_vd'+k)))e.innerHTML=DvdPrice._vendor[compare.vendorSel[k]].name;}},calcPricesOne:function(){DvdPrice._calcMany=0;var a_all_prc=[],a_all_cnt=[],a_all_shp=[],a_all_tax=[],state=DvdPrice._getState(),i,e,v;for(i=0;i<DvdPrice._totVendors;i++){a_all_prc[i]=0;a_all_cnt[i]=0;}for(i=0;i<DvdPrice._totVendors;i++){if((v=Dbl.parse(compare.prices[i]))>0){a_all_prc[i]=v;a_all_cnt[i]=1;}else{a_all_prc[i]=0;a_all_cnt[i]=0;}a_all_shp[i]=0;}a_all_shp=DvdPrice._calcShipping(a_all_prc,a_all_cnt);a_all_tax=DvdPrice._calcTaxes(a_all_prc,state);var best=99999;for(i=0;i<DvdPrice._totVendors;i++){if(a_all_prc[i]>0){a_all_prc[i]+=a_all_shp[i]+a_all_cnt[i];if(best>a_all_prc[i])best=a_all_prc[i];}if((e=$('td_shp'+i)))e.innerHTML=Dbl.toStr(a_all_shp[i],'-');if((e=$('td_tax'+i)))e.innerHTML=Dbl.toStr(a_all_tax[i],'-');if((e=$('td_tot'+i)))e.innerHTML=Dbl.toStr(a_all_prc[i],'-');}i=Dec.parse(Cookie.get('zero'));best+=(i>0?i:0.1)/100;for(i=0;i<DvdPrice._totVendors;i++){c=(a_all_prc[i]>0&&a_all_prc[i]<=best)?'pr1_lowest':'';if((e=$('td_sub'+i)))e.className=c;if((e=$('td_shp'+i)))e.className=c;if((e=$('td_tax'+i)))e.className=c;if((e=$('td_tot'+i)))e.className=c;if((e=$('td_off'+i)))e.className=c;}},_calcPrices:function(){if(DvdPrice._calcMany)DvdPrice.calcPricesMany();else DvdPrice.calcPricesOne();},_calcShipping:function(a_tot,a_cnt){var a_shp=[],i,b=Cookie.get('ship')=='paid';for(i=0;i<DvdPrice._totVendors;i++)a_shp[i]=b?DvdPrice._vendor[i].ship(a_cnt[i],a_tot[i]):0;return a_shp;},_calcTaxes:function(a_tot,s_state){var a_tax=[],i;for(i=0;i<DvdPrice._totVendors;i++)a_tax[i]=typeof(DvdPrice._vendor[i].tax[s_state])=='undefined'?0:DvdPrice._vendor[i].tax[s_state]*a_tot[i]/100;return a_tax;},_strItems:function(n){return(n?(n==1?'1&nbsp;item':n+'&nbsp;items'):'no&nbsp;items');},routeToVendor:function(n_vendor,n_dvd_id){Win.openStd('pc.php?tg='+n_vendor+'&amp;id='+n_dvd_id+'&amp;qc=1',DvdPrice._vendor[n_vendor].key);},selLowestPrice:function(){var i,k,e;for(i=0;i<DvdPrice._totVendors;i++)if((e=$('cx_vendor'+i)))e.checked=false;for(k=0;k<compare.totRows;k++){i=compare.lowest[k];if(i>=0){e=$('cx_'+k+'_'+i);if(e){e.checked=true;DvdPrice.selVendorForItem(e,k,i,false);}}}DvdPrice.calcPricesMany();},selVendor:function(n_ven){var i,k,e;if((e=$('cx_lowest')))e.checked=false;for(i=0;i<DvdPrice._totVendors;i++)if(i!=n_ven&&(e=$('cx_vendor'+i)))e.checked=false;for(k=0,i=n_ven;k<compare.totRows;k++){if(compare.prices[k][i]>0){e=$('cx_'+k+'_'+i);if(e){e.checked=true;DvdPrice.selVendorForItem(e,k,i,false);}}}DvdPrice.calcPricesMany();},selVendorForItem:function(o_cb,n_row,n_ven,b_calc){var i,e,f,a,b;if(b_calc){if((e=$('cx_lowest')))e.checked=false;for(i=0;i<DvdPrice._totVendors;i++)if((e=$('cx_vendor'+i)))e.checked=false;}if((e=$('td_vd'+n_row)))e.innerHTML=o_cb.checked?DvdPrice._vendor[n_ven].name:'-';if((e=$('td_pc'+n_row)))e.innerHTML=o_cb.checked?compare.prices[n_row][n_ven]+"<div>"+(compare.diff[n_row][n_ven]?compare.diff[n_row][n_ven]:'0.00')+'</div>':'-';for(i=0;i<DvdPrice._totVendors;i++){if((e=$('td_'+n_row+'_'+i))&&(f=$('cx_'+n_row+'_'+i))){if(i!=n_ven)f.checked=false;e.className=f.checked?(compare.lowest[n_row]==i?'pri_def':'pri_ndf'):'';}}Cart.click(''+compare.dvdid[n_row],true,compare.lowest[n_row]==n_ven?-1:n_ven);if(b_calc)DvdPrice.calcPricesMany();},setState:function(e){var i=DropDown.getSelValue(e);if(!i)i=0;Cookie.set('state',i);DvdPrice._calcPrices();return true;},setFreeShipping:function(e){Cookie.set('ship',e.checked?'':'paid');DvdPrice._calcPrices();},setZero:function(e){var i=DropDown.getSelValue(e);if(!i)i=10;Cookie.set('zero',i);DvdPrice._calcPrices();return true;},showCookies:function(){Win.openPop(true,'cookies',Filmaf.baseDomain+'/utils/show-cookies.html?pop=1',460,310,1,1);},cleanCookies:function(b_all){if(Cookie.clean(b_all)){Cart.highlight(true);DvdPrice.getState();DvdPrice.updateCartSelect();DvdPrice._resetVendorSelection();DvdPrice.showCookies();}},getState:function(){var s,e,i;if((s=Cookie.get('state'))=='')s='0';if((e=$('sel_state')))if(!DropDown.selectFromVal(e,s))DropDown.selectFromVal(e,(s='0'));if((e=$('sp_state')))e.innerHTML=s&&s!='0'?s:'none';if((e=$('cx_shipping')))e.checked=Cookie.get('ship')!='paid';if((e=$('sel_zero')))if(!DropDown.selectFromVal(e,Dec.parse(Cookie.get('zero'))))DropDown.selectFromVal(e,'10');},saveCart:function(){var e,s,c,z,y,n;if(!(c=Cookie.get('cart'))){alert('Sorry, your cart is empty. There is nothing to save.');return false;}if((e=$('cartname'))){s=Str.trim(e.value.replace(/[^a-zA-Z0-9\x20-]/g,''));e.value=s;if(!s){alert("Sorry, you must enter a valid cart name. You may use letters\nand numbers as well as spaces and the dash ('-'). Other\ncharacters are not supported and are automatically removed.");return false;}if((z=Cookie.get('saved')))if((z=DvdPrice._removeCartFromString(z,s,"We already hava cart named '"+s+"'. Would you like to replace it?\n\nOK=Yes - Cancel=No"))===false)return false;z=s+':'+c+(z?'|'+z:'');if(z.lenght>1500){alert('Sorry, your saved carts would be larger than 1500 bytes.\nWe can not complete this operation.');return false;}if(z.lenght+c.lenght>2300){alert('Sorry, your saved carts plus your current cart would be larger\nthan 2300 bytes. We can not complete this operation.');return false;}Cookie.set('saved',z);DvdPrice.updateCartSelect();alert("Your cart has been saved as '"+s+"'");}return false;},loadCart:function(){var e,s,z,n;if((e=$('sel_cart'))){s=DropDown.getSelValue(e);if(s&&(z=Cookie.get('saved'))){z='|'+z;n=z.indexOf('|'+s+':');if(n>=0){z=z.substr(n+1);n=z.indexOf(':');z=z.substr(n+1);n=z.indexOf('|');if(n>=0)z=z.substr(0,n);Cookie.set('cart',z);location.href=location.href;}}}},deleteCart:function(s){var e,s,z,n;if((e=$('sel_cart'))){s=DropDown.getSelValue(e);if(s&&(z=Cookie.get('saved'))){if((z=DvdPrice._removeCartFromString(z,s,"Are you sure you want to remove the cart named '"+s+"'?\n\nOK=Yes - Cancel=No"))!==false){Cookie.set('saved',z);DvdPrice.updateCartSelect();alert("The cart named '"+s+"' has been deleted.");}}}return false;},updateCartSelect:function(){var e,i,z,n,s;if((e=$('sel_cart'))){DropDown.removeOptions(e);if((z=Cookie.get('saved'))){z=z.split('|');for(i=0;i<z.length;i++){n=z[i].indexOf(':');s=z[i].substr(0,n);DropDown.addOption(e,s,s);}}else{DropDown.addOption(e,'-','...you have no saved carts...');}}},_resetVendorSelection:function(){var i,e;for(var i=0;i<DvdPrice._totVendors;i++)if((e=$('cx_exclude'+i)))e.checked=true;},_removeCartFromString:function(s_saved,s_remove,s_confirm){var y,z,n;if(s_saved){z='|'+s_saved;n=z.indexOf('|'+s_remove+':');if(n>=0){if(s_confirm){y=confirm(s_confirm);if(!y)return false;}y=z.substr(0,n);z=z.substr(n+1);n=z.indexOf('|');if(n>=0)y+=z.substr(n);return y.substr(1);}}return s_saved;},excludeVendor:function(){var i,k,e,s,c=Cookie.get('excl');c=c?','+c+',':'';for(i=0,k=0;i<DvdPrice._totVendors;i++){if((e=$('cx_exclude'+i))){s=DvdPrice._vendor[i].key;if(e.checked){c=c.replace(new RegExp(','+s+',','g'),',');k++;}else{if(c.indexOf(','+s+',')<0)c+=s+',';}}}if(k<2){alert('Sorry, at least 2 vendors must be selected.');}else{Cookie.set('excl',c);location.href=location.href;}return true;}};